# 领域知识库: 物联网 (IoT - Internet of Things)

> **自动生成**: 由 Super Dev 领域扩展器生成或人工创建
> **用途**: 专家 (Experts) 在处理物联网任务时**必须**读取此文件
> **最后更新**: 2025-12-30

---

## 1. 合规与法规 (Compliance)

### 1.1 中国合规要求

| 法规 | 关键要求 | 适用场景 |
|:---|:---|:---|
| **《网络安全法》** | 设备认证、数据加密 | 所有IoT设备 |
| **《数据安全法》** | 数据分类分级、风险评估 | 数据采集处理 |
| **《个人信息保护法》(PIPL)** | 用户同意、最小化采集 | 个人设备数据 |
| **《物联网终端安全指南》** | 安全基线、漏洞管理 | 设备制造 |
| **《智能网联汽车道路测试管理规范》** | 车联网安全测试 | 智能汽车 |

### 1.2 国际合规要求

| 法规 | 关键要求 | 适用场景 |
|:---|:---|:---|
| **GDPR** | 数据保护、用户同意 | 欧洲用户 |
| **CCPA** | 隐私权、数据出售 | 加州用户 |
| **RED (Radio Equipment Directive)** | 无线设备安全 | 欧盟设备 |
| **FCC Part 15** | 无线频段合规 | 美国设备 |
| **UL/IEC 62368** | 电气安全标准 | 全球设备 |

---

## 2. 行业标准与协议 (Standards)

### 2.1 通信协议

| 协议 | 层级 | 用途 |
|:---|:---|:---|
| **MQTT** | 应用层 | 轻量级消息传输 |
| **CoAP** | 应用层 | 受限网络资源 |
| **HTTP/HTTPS** | 应用层 | 标准Web服务 |
| **WebSocket** | 应用层 | 实时双向通信 |
| **LoRaWAN** | MAC层 | 长距离低功耗 |
| **NB-IoT** | 物理层 | 蜂窝物联网 |

### 2.2 数据标准

| 标准 | 用途 |
|:---|:---|
| **JSON Schema** | 设备消息格式 |
| **SenML** | 传感器数据编码 |
| **OPC UA** | 工业设备通信 |
| **Thread** | 智能家居Mesh网络 |

---

## 3. 设计最佳实践 (UI/UX)

### 3.1 IoT 应用 UX 原则

| 原则 | 说明 | 实践 |
|:---|:---|:---|
| **实时性** | 状态即时同步 | WebSocket、推送通知 |
| **简洁性** | 减少操作步骤 | 一键控制、场景模式 |
| **可视化** | 数据直观展示 | 图表、热力图、3D视图 |
| **可访问性** | 远程控制 | 移动端、语音控制 |

### 3.2 关键页面

```
设备列表 → 设备详情 → 实时控制 → 数据分析 → 场景自动化 → 设置
```

| 页面 | 核心指标 | 优化要点 |
|:---|:---|:---|
| **设备列表** | 在线率、响应速度 | 状态刷新、快速操作 |
| **设备详情** | 停留时长 | 实时数据、历史曲线 |
| **场景控制** | 使用率 | 一键执行、定时任务 |
| **数据分析** | 查看频次 | 可视化报表、异常告警 |

---

## 4. 安全红线 (Security)

### 4.1 设备安全

| 威胁 | 防护措施 |
|:---|:---|
| **固件篡改** | 安全启动、固件签名 |
| **中间人攻击** | TLS/DTLS加密 |
| **重放攻击** | 时间戳、随机数 |
| **暴力破解** | 速率限制、账户锁定 |
| **僵尸网络** | 设备认证、异常检测 |

### 4.2 数据安全

```
安全传输:
- 传输层: TLS 1.3 / DTLS
- 应用层: 端到端加密
- 密钥管理: 设备证书 + 密钥轮换

安全存储:
- 设备端: TPM/SE 安全芯片
- 云端: 加密存储 + 密钥管理服务
- 传输中: 链路加密
```

### 4.3 隐私保护

```
敏感数据处理:
- 位置信息: 模糊化、用户授权
- 摄像头: 本地处理、加密上传
- 语音: 离线唤醒、云端加密
- 行为数据: 匿名化、聚合分析
```

---

## 5. IoT 业务特定考虑

### 5.1 核心业务模式

| 模式 | 关键指标 | 实现要点 |
|:---|:---|:---|
| **智能家居** | 设备激活率、场景使用 | 互联互通、语音控制 |
| **工业物联网** | 设备OEE、故障率 | 高可靠性、边缘计算 |
| **车联网** | 在线时长、数据量 | 低延迟、高带宽 |
| **可穿戴设备** | 日活、健康数据准确性 | 低功耗、隐私保护 |

### 5.2 设备管理

```python
# 设备状态机
class DeviceState:
    UNPROVISIONED = "未配置"
    PROVISIONING = "配置中"
    ACTIVE = "在线"
    INACTIVE = "离线"
    MAINTENANCE = "维护中"
    DECOMMISSIONED = "已退役"

# 设备注册流程
def register_device(device_info):
    # 1. 设备认证
    if not verify_certificate(device_info.cert):
        return "认证失败"

    # 2. 创建设备身份
    device_id = generate_device_id()

    # 3. 颁发设备证书
    device_cert = issue_device_certificate(device_id)

    # 4. 配置访问策略
    configure_policy(device_id)

    return device_id
```

---

## 6. 通信架构

### 6.1 网络拓扑

```
典型IoT架构:

传感器/执行器
    ↓ (MQTT/CoAP)
边缘网关
    ↓ (MQTT/HTTP)
云平台
    ↓ (REST/WebSocket)
用户应用
```

### 6.2 消息协议选择

| 协议 | 优势 | 劣势 | 适用场景 |
|:---|:---|:---|
| **MQTT** | 轻量、QoS、发布订阅 | 需要Broker | 传感器数据上报 |
| **HTTP** | 通用、易调试 | 开销大、无状态 | 设备配置、OTA |
| **CoAP** | 资源受限、UDP | 生态较小 | 6LoWPAN网络 |
| **WebSocket** | 实时双向 | 连接管理复杂 | 实时控制 |

### 6.3 消息QoS设计

```
MQTT QoS级别:
0 - 最多一次: 丢包无影响 (环境温度)
1 - 至少一次: 允许重复 (报警通知)
2 - 恰好一次: 不允许重复 (控制指令)

消息设计:
- 主题设计: /{tenant}/{device_type}/{device_id}/{resource}
- 消息 payload: JSON格式，包含timestamp、device_id、data
- 消息大小: < 256KB (推荐)
```

---

## 7. 数据处理

### 7.1 数据采集

| 数据类型 | 采样频率 | 压缩方式 |
|:---|:---|:---|
| **状态数据** | 变化时上报 | 增量编码 |
| **遥测数据** | 周期上报 (1s~1h) | Delta编码 |
| **事件数据** | 触发上报 | 无压缩 |
| **日志数据** | 批量上报 | Gzip |

### 7.2 数据存储

```
时序数据库设计 (InfluxDB/TimescaleDB):

measurement: sensor_data
tags: device_id, device_type, location
fields: temperature, humidity, pressure
time: timestamp

查询优化:
- 按时间分片
- 热数据SSD，冷数据HDD
- 定期降采样 (1分钟 → 1小时 → 1天)
- 保留策略 (7天/30天/365天)
```

### 7.3 边缘计算

```python
# 边缘计算决策
def should_process_on_edge(data):
    """
    判断是否在边缘处理
    """
    # 低延迟需求
    if data.requires_realtime_response:
        return True

    # 大数据量
    if data.size > threshold:
        return True

    # 隐私敏感
    if data.privacy_level == HIGH:
        return True

    # 网络不稳定
    if network_quality == POOR:
        return True

    return False
```

---

## 8. 设备OTA (Over-The-Air)

### 8.1 OTA流程

```
OTA升级流程:

1. 云平台生成升级包
2. 设备检测更新
3. 下载升级包 (断点续传)
4. 校验升级包 (签名验证)
5. 安装升级包
6. 重启设备
7. 上报升级结果
```

### 8.2 OTA策略

| 策略 | 说明 |
|:---|:---|
| **灰度发布** | 先升级小批量设备，验证后全量 |
| **分批升级** | 避免所有设备同时升级 |
| **回滚机制** | 升级失败自动回滚 |
| **版本管理** | 多版本共存，按需推送 |

---

## 9. 监控与运维

### 9.1 设备监控

| 监控项 | 告警阈值 |
|:---|:---|
| **设备在线率** | < 95% |
| **消息延迟** | > 5秒 |
| **电池电量** | < 20% |
| **内存使用率** | > 85% |
| **固件版本** | 过期版本 |

### 9.2 故障诊断

```
故障诊断流程:

1. 设备离线
   ↓ 检查网络连接
2. 消息延迟
   ↓ 检查Broker负载
3. 数据异常
   ↓ 检查传感器校准
4. 固件崩溃
   ↓ 分析crash dump
5. 恢复措施
   - 远程重启
   - OTA回滚
   - 派单维修
```

---

## 10. 常见陷阱 (PITFALLS)

### 10.1 技术陷阱

- ❌ **忽视功耗**: 电池设备快速耗尽
- ❌ **不处理网络抖动**: 消息丢失或重复
- ❌ **硬编码密钥**: 设备大规模破解
- ❌ **不限制频率**: 消息风暴

### 10.2 设计陷阱

- ❌ **忽视离线模式**: 网络断开无法使用
- ❌ **过度依赖云端**: 延迟高、可靠性差
- ❌ **忽视设备多样性**: 不同设备能力差异大
- ❌ **忽视向后兼容**: 旧设备无法升级

### 10.3 运营陷阱

- ❌ **忽视设备老化**: 传感器漂移未校准
- ❌ **不维护固件**: 安全漏洞累积
- ❌ **忽视用户体验**: 配置复杂、连接困难
- ❌ **忽视数据成本**: 流量费用高昂

---

**专家使用提示**:
- PM: IoT产品核心是设备连接和数据价值
- Architect: 系统架构需要考虑海量设备和高并发
- Security: 设备安全和隐私保护是生命线
- DevOps: 需要处理设备监控、OTA和故障恢复
- UI/UX: 简化配网流程，提供直观的设备控制
