# 领域知识库: 微信小程序 (Weapp)

> **上下文**: 适用于 `platform="miniapp"` 或 `platform="wechat"`。

## 1. 生态限制 (紧箍咒)

### 1.1 硬性指标
- **包体积**: 单包 < 2MB。总包 < 20MB。
    - *策略*: 激进的分包策略 (Sub-packages)。
- **请求域名**: 必须是 HTTPS，且在后台白名单配置。
- **层级**: 页面栈最深 10 层 (`wx.navigateTo`)。需配合 `wx.redirectTo` 使用。

### 1.2 用户身份 (Login 2.0)
- **拒绝静默获取信息**: `wx.getUserProfile` 已废弃。
- **手机号**: 需单独鉴权且收费（企业认证主体）。
- **OpenID**: 唯一可静默获取的标识符 `wx.login()`。

## 2. UI/UX 标准 (WeUI)
- **导航栏**: 谨慎自定义导航栏（Android 碎片化严重）。除非 P0 需求，否则用原生。
- **下拉刷新**: 在 JSON 中配置 `enablePullDownRefresh`，不要用 JS 模拟。
- **分享**: 每个页面都应定义 `onShareAppMessage`，分享图比例 5:4。

## 3. 支付流程
- **实物商品**: 允许。
- **虚拟商品**: iOS 端 **严禁**（苹果税合规问题）。结果 = 封禁小程序。
    - *规避*: "联系客服" 按钮（灰色地带，风险高）。

## 4. 性能优化
- **setData 开销**: 严禁传输大对象。只 diff 变化的数据。
- **WXS**: 高频交互（如滚动联动）使用 WXS，避免逻辑层与视图层的通信开销。
